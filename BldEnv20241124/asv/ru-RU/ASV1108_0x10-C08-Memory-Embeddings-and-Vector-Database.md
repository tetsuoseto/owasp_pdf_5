# Память C8, эмбеддинги и безопасность векторных баз данных

## Цель управления

Эмбеддинги и векторные хранилища выступают в роли «живой памяти» современных ИИ-систем, постоянно принимая данные, предоставляемые пользователем, и возвращая их в контексты моделей через Retrieval-Augmented Generation (RAG). Если не контролировать эту память, она может раскрывать персональные данные (PII), нарушать согласие или быть инвертирована для восстановления исходного текста. Целью этой группы контролей является укрепление конвейеров памяти и векторных баз данных так, чтобы доступ был минимально привилегированным, эмбеддинги обеспечивали сохранение приватности, хранимые векторы имели срок хранения или могли быть отозваны по запросу, а память, относящаяся к одному пользователю, никоим образом не влияла на подсказки или результаты другого пользователя.

---

## C8.1 Контроль доступа к памяти и индексам RAG

Обеспечьте детализированный контроль доступа к каждой коллекции векторов.

|   #   | Description                                                                                                                                                                                | Level | Role |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :---: | :--: |
| 8.1.1 | Проверьте, что правила контроля доступа на уровне строки/пространства имён ограничивают операции вставки, удаления и запроса в соответствии с арендатором, коллекцией или тегом документа. |   1   | D/V  |
| 8.1.2 | Убедитесь, что API-ключи или JWT содержат ограниченные диапазоном полномочия (например, идентификаторы коллекций, глаголы действий) и подвергаются ротации как минимум раз в квартал.      |   1   | D/V  |
| 8.1.3 | Проверьте, что попытки повышения привилегий (например, запросы схожести между пространствами имён) обнаруживаются и регистрируются в SIEM в течение 5 минут.                               |   2   | D/V  |
| 8.1.4 | Проверьте, что в векторной базе данных аудит логирует идентификатор субъекта, операцию, ID вектора/пространство имён, порог сходства и количество результатов.                             |   2   | D/V  |
| 8.1.5 | Проверьте, что решения о доступе тестируются на наличие уязвимостей обхода всякий раз при обновлении движков или изменении правил шардинга индексов.                                       |   3   |  V   |

---

## C8.2 Очистка и проверка встраиваемого содержимого

Предварительно проверяйте текст на наличие личной идентифицирующей информации (PII), затем редактируйте или псевдонимизируйте его перед векторизацией, а при необходимости выполняйте постобработку эмбеддингов для удаления оставшихся сигналов.

|   #   | Description                                                                                                                                                                                              | Level | Role |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---: | :--: |
| 8.2.1 | Проверьте, что Персональные данные (PII) и регулируемые данные обнаруживаются с помощью автоматических классификаторов и маскируются, токенизируются или удаляются до этапа эмбеддинга.                  |   1   | D/V  |
| 8.2.2 | Проверьте, что пайплайны эмбеддинга отклоняют или помещают в карантин входные данные, содержащие исполняемый код или артефакты не в формате UTF-8, которые могут повредить индекс.                       |   1   |  D   |
| 8.2.3 | Проверьте, что к эмбеддингам предложений, расстояние которых до любого известного токена PII меньше настраиваемого порога, применяется локальная или метрика-дифференциальная приватность для санитации. |   2   | D/V  |
| 8.2.4 | Убедитесь, что эффективность очистки данных (например, полнота удаления персональных данных, семантический сдвиг) проверяется не реже чем раз в полгода по эталонным корпусам.                           |   2   |  V   |
| 8.2.5 | Убедитесь, что конфигурации санации находятся под контролем версий, а изменения проходят проверку коллег.                                                                                                |   3   | D/V  |

---

## C8.3 Истечение срока действия памяти, отзыв и удаление

Законодательство, такое как GDPR и аналогичные законы о «праве на забвение», требует своевременного удаления данных; поэтому хранилища векторов должны поддерживать время жизни (TTL), жесткие удаления и использование пометок удаления (tomb-stoning), чтобы отозванные векторы не могли быть восстановлены или повторно индексированы.

|   #   | Description                                                                                                                                                                       | Level | Role |
| :---: | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---: | :--: |
| 8.3.1 | Убедитесь, что каждая запись векторов и метаданных содержит TTL (время жизни) или явную метку удержания, соблюдаемую автоматическими задачами очистки.                            |   1   | D/V  |
| 8.3.2 | Подтвердите, что запросы на удаление, инициированные пользователем, удаляют векторы, метаданные, копии в кэше и производные индексы в течение 30 дней.                            |   1   | D/V  |
| 8.3.3 | Проверьте, что логическое удаление сопровождается криптографическим уничтожением блоков хранения, если оборудование это поддерживает, или уничтожением ключа из хранилища ключей. |   2   |  D   |
| 8.3.4 | Проверьте, что устаревшие векторы исключаются из результатов поиска ближайших соседей менее чем через 500 мс после их истечения.                                                  |   3   | D/V  |

---

## C8.4 Предотвращение обращения и утечки встраиваний

Недавние методы защиты — наложение шума, проекционные сети, возмущение нейронов конфиденциальности и шифрование на уровне приложений — могут снизить уровень восстановления токенов до менее чем 5%.

|   #   | Description                                                                                                                                                                      | Level | Role |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---: | :--: |
| 8.4.1 | Убедитесь, что существует формальная модель угроз, охватывающая атаки инверсии, определения членства и вывода атрибутов, и что она пересматривается ежегодно.                    |   1   |  V   |
| 8.4.2 | Убедитесь, что шифрование на уровне прикладного слоя или поиск по зашифрованным данным защищает векторы от прямого чтения администраторами инфраструктуры или персоналом облака. |   2   | D/V  |
| 8.4.3 | Проверьте, что параметры защиты (ε для DP, шум σ, ранг проекции k) обеспечивают конфиденциальность ≥ 99 % защиты токенов и полезность ≤ 3 % потери точности.                     |   3   |  V   |
| 8.4.4 | Убедитесь, что метрики устойчивости к инверсии являются частью контрольных точек выпуска обновлений модели, с определёнными бюджетами регрессий.                                 |   3   | D/V  |

---

## C8.5 Контроль доступа для памяти, специфичной для пользователя

Перекрестные утечки между арендаторами остаются одной из основных рисков RAG: неправильно отфильтрованные запросы на поиск сходств могут выявить приватные документы другого клиента.

|   #   | Description                                                                                                                                                                          | Level | Role |
| :---: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :---: | :--: |
| 8.5.1 | Убедитесь, что каждый запрос на извлечение данных после обработки фильтруется по идентификатору арендатора/пользователя перед передачей в LLM-промпт.                                |   1   | D/V  |
| 8.5.2 | Проверьте, что имена коллекций или идентификаторы с пространствами имён сольются (сольются?) для каждого пользователя или арендатора, чтобы векторы не пересекались между областями. |   1   |  D   |
| 8.5.3 | Проверьте, что результаты сходства выше настраиваемого порогового расстояния, но вне области вызова, отбрасываются и вызывают уведомления о безопасности.                            |   2   | D/V  |
| 8.5.4 | Проверьте, что многоарендные стресс-тесты моделируют враждебные запросы, пытающиеся получить документы вне области доступа, и демонстрируют отсутствие утечек.                       |   2   |  V   |
| 8.5.5 | Убедитесь, что ключи шифрования разделены по арендаторам, обеспечивая криптографическую изоляцию даже при общем физическом хранении.                                                 |   3   | D/V  |

---

## C8.6 Продвинутая безопасность системы памяти

Контроль безопасности для сложных архитектур памяти, включая эпизодическую, семантическую и рабочую память, с особыми требованиями к изоляции и проверке.

|   #   | Description                                                                                                                                                                                                                                                    | Level | Role |
| :---: | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :---: | :--: |
| 8.6.1 | Проверьте, что различные типы памяти (эпизодическая, семантическая, рабочая) имеют изолированные контексты безопасности с управлением доступом на основе ролей, отдельными ключами шифрования и документированными шаблонами доступа для каждого типа памяти.  |   1   | D/V  |
| 8.6.2 | Проверьте, что процессы консолидации памяти включают проверку безопасности для предотвращения внедрения вредоносных воспоминаний посредством очистки содержания, проверки источника и проверки целостности перед сохранением.                                  |   2   | D/V  |
| 8.6.3 | Проверьте, что запросы к памяти проходят проверку и очистку для предотвращения извлечения несанкционированной информации через анализ шаблонов запросов, применение контроля доступа и фильтрацию результатов.                                                 |   2   | D/V  |
| 8.6.4 | Проверьте, что механизмы забывания памяти надежно удаляют конфиденциальную информацию с криптографическими гарантиями стирания с использованием удаления ключей, многократного перезаписывания или аппаратного безопасного удаления с сертификатами проверки.  |   3   | D/V  |
| 8.6.5 | Убедитесь, что целостность системы памяти постоянно контролируется на предмет несанкционированных изменений или повреждений с помощью контрольных сумм, журналов аудита и автоматических оповещений при изменениях содержимого памяти вне нормальных операций. |   3   | D/V  |

---

## Ссылки

* [Vector database security: Pinecone – IronCore Labs](https://ironcorelabs.com/vectordbs/pinecone-security/)
* [Securing the Backbone of AI: Safeguarding Vector Databases and Embeddings – Privacera](https://privacera.com/blog/securing-the-backbone-of-ai-safeguarding-vector-databases-and-embeddings/)
* [Enhancing Data Security with RBAC of Qdrant Vector Database – AI Advances](https://ai.gopubby.com/enhancing-data-security-with-role-based-access-control-of-qdrant-vector-database-3878769bec83)
* [Mitigating Privacy Risks in LLM Embeddings from Embedding Inversion – arXiv](https://arxiv.org/html/2411.05034v1)
* [DPPN: Detecting and Perturbing Privacy-Sensitive Neurons – OpenReview](https://openreview.net/forum?id=DF5TVzpTW0)
* [Art. 17 GDPR – Right to Erasure](https://gdpr-info.eu/art-17-gdpr/)
* [Sensitive Data in Text Embeddings Is Recoverable – Tonic.ai](https://www.tonic.ai/blog/sensitive-data-in-text-embeddings-is-recoverable)
* [PII Identification and Removal – NVIDIA NeMo Docs](https://docs.nvidia.com/nemo-framework/user-guide/latest/datacuration/personalidentifiableinformationidentificationandremoval.html)
* [De-identifying Sensitive Data – Google Cloud DLP](https://cloud.google.com/sensitive-data-protection/docs/deidentify-sensitive-data)
* [Remove PII from Conversations Using Sensitive Information Filters – AWS Bedrock Guardrails](https://docs.aws.amazon.com/bedrock/latest/userguide/guardrails-sensitive-filters.html)
* [Think Your RAG Is Secure? Think Again – Medium](https://medium.com/%40vijay.poudel1/think-your-rag-is-secure-think-again-heres-how-to-actually-lock-it-down-c4c30e3864e7)
* [Design a Secure Multitenant RAG Inferencing Solution – Microsoft Learn](https://learn.microsoft.com/en-us/azure/architecture/ai-ml/guide/secure-multitenant-rag)
* [Best Practices for Multi-Tenancy RAG with Milvus – Milvus Blog](https://milvus.io/blog/build-multi-tenancy-rag-with-milvus-best-practices-part-one.md)

