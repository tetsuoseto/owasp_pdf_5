# C2 ユーザー入力検証

## 管理目的

ユーザー入力の堅牢な検証は、AIシステムに対する最も破壊的な攻撃のいくつかに対する最前線の防御手段です。プロンプトインジェクション攻撃は、システムの指示を上書きしたり、機密データを漏洩させたり、モデルを許可されていない動作に誘導したりする可能性があります。専用のフィルターや指示の階層構造が整備されていない限り、研究によれば非常に長いコンテキストウィンドウを悪用する「マルチショット」ジェイルブレイクが効果的であることが示されています。また、ホモグリフの置換やリートスピークのような微妙な敵対的摂動攻撃も、モデルの判断を密かに変更する可能性があります。

---

## C2.1 プロンプトインジェクション防御

プロンプトインジェクションはAIシステムにおける主要なリスクの一つです。これに対する防御策は、静的パターンフィルター、動的分類器、および指示階層の強制を組み合わせて実施されます。

|   #   | Description                                                                                                    | Level | Role |
| :---: | -------------------------------------------------------------------------------------------------------------- | :---: | :--: |
| 2.1.1 | ユーザーの入力が、継続的に更新される既知のプロンプトインジェクションパターン（ジャイルブレイクキーワード、「以前を無視」、ロールプレイチェーン、間接的なHTML/URL攻撃）に対して検査されていることを確認してください。 |   1   | D/V  |
| 2.1.2 | システムがコンテキストウィンドウの拡張後でも、システムまたは開発者のメッセージがユーザーの指示に優先する指示階層を強制していることを確認してください。                                    |   1   | D/V  |
| 2.1.3 | 敵対的評価テスト（例：レッドチームの「多数ショット」プロンプト）が、すべてのモデルやプロンプトテンプレートのリリース前に実施され、成功率のしきい値および回帰を防ぐ自動ブロッカーが設定されていることを確認してください。   |   2   | D/V  |
| 2.1.4 | サードパーティのコンテンツ（ウェブページ、PDF、メール）から発信されるプロンプトが、メインプロンプトに連結される前に、分離されたパースコンテキストで適切にサニタイズされていることを確認してください。           |   2   |  D   |
| 2.1.5 | すべてのプロンプトフィルタールールの更新、分類器モデルのバージョン、およびブロックリストの変更がバージョン管理され、監査可能であることを確認してください。                                  |   3   | D/V  |

---

## C2.2 対抗例耐性

自然言語処理（NLP）モデルは、ヒトが見逃しがちな微妙な文字または単語レベルの摂動に対して依然として脆弱であり、モデルはそれを誤分類する傾向があります。

|   #   | Description                                                                                   | Level | Role |
| :---: | --------------------------------------------------------------------------------------------- | :---: | :--: |
| 2.2.1 | 基本的な入力正規化手順（Unicode NFC、類似文字マッピング、空白のトリミング）がトークン化の前に実行されることを確認してください。                         |   1   |  D   |
| 2.2.2 | 統計的異常検出が言語の規範から著しく離れた編集距離、不自然に繰り返されるトークン、または異常な埋め込み距離を持つ入力を検出することを確認してください。                   |   2   | D/V  |
| 2.2.3 | 推論パイプラインが、オプションの敵対的トレーニング耐性モデルバリアントや防御レイヤー（例：ランダム化、防御的蒸留）を高リスクのエンドポイント向けにサポートしていることを検証してください。 |   2   |  D   |
| 2.2.4 | 疑わしい敵対的入力が隔離され、（PIIの削除後に）完全なペイロードとともにログ記録されていることを確認してください。                                    |   2   |  V   |
| 2.2.5 | 既知の攻撃スイートの成功率などの堅牢性指標が時間経過で追跡されており、回帰が発生した場合にはリリースのブロッカーがトリガーされることを確認してください。                  |   3   | D/V  |

---

## C2.3 スキーマ、型および長さの検証

不正な形式や過大な入力を伴うAI攻撃は、パースエラー、フィールド間のプロンプトの漏れ、リソース枯渇を引き起こす可能性があります。厳格なスキーマの適用は、決定論的なツール呼び出しを行う際にも必須条件です。

|   #   | Description                                                                                                    | Level | Role |
| :---: | -------------------------------------------------------------------------------------------------------------- | :---: | :--: |
| 2.3.1 | すべてのAPIまたは関数呼び出しのエンドポイントが明確な入力スキーマ（JSONスキーマ、Protobuf、またはマルチモーダルに相当するもの）を定義し、プロンプトの組み立て前に入力が検証されていることを確認してください。 |   1   |  D   |
| 2.3.2 | 入力が最大トークン数またはバイト数の制限を超えた場合、安全なエラーで拒否され、決して静かに切り詰められないことを確認してください。                                              |   1   | D/V  |
| 2.3.3 | 型チェック（例：数値範囲、列挙型の値、画像や音声のMIMEタイプ）がクライアント側コードだけでなく、サーバー側でも確実に実施されていることを確認してください。                                |   2   | D/V  |
| 2.3.4 | セマンティックバリデーター（例：JSONスキーマ）がアルゴリズム的なDoSを防ぐために一定時間で実行されることを検証してください。                                              |   2   |  D   |
| 2.3.5 | 検証失敗が、セキュリティトリアージを支援するために、修正済みペイロードの抜粋と明確なエラーコードとともにログ記録されていることを確認してください。                                      |   3   |  V   |

---

## C2.4 コンテンツおよびポリシースクリーニング

開発者は、許可されていない内容（違法な指示、ヘイトスピーチ、著作権で保護されたテキストなど）を要求する、構文的に有効なプロンプトを検出し、それらが拡散するのを防止できるようにする必要があります。

|   #   | Description                                                                                  | Level | Role |
| :---: | -------------------------------------------------------------------------------------------- | :---: | :--: |
| 2.4.1 | コンテンツ分類器（ゼロショットまたはファインチューニング済み）が、暴力、自傷行為、ヘイト、性的内容、違法な要求について、設定可能なしきい値で全ての入力を評価することを確認してください。 |   1   |  D   |
| 2.4.2 | ポリシーに違反する入力が、標準化された拒否応答または安全な補完を受け取り、それが下流の大規模言語モデル（LLM）呼び出しに伝播しないことを確認してください。               |   1   | D/V  |
| 2.4.3 | スクリーニングモデルまたはルールセットが、少なくとも四半期ごとに、新たに観察されたジャイルブレイクやポリシーバイパスのパターンを取り入れて再学習・更新されていることを確認してください。 |   2   |  D   |
| 2.4.4 | 属性ベースのルールを使用してリクエスト時に解決されるユーザー固有のポリシー（年齢、地域の法的制約）を遵守していることを検証します。                            |   2   |  D   |
| 2.4.5 | スクリーニングログに分類器の信頼度スコアとポリシーカテゴリタグが含まれていることを確認し、SOCの相関分析および将来のレッドチーム再現に役立てます。                   |   3   |  V   |

---

## C2.5 入力レート制限と悪用防止

開発者は、入力速度を制限し、異常な使用パターンを検出することで、AIシステムに対する悪用、リソースの枯渇、自動化された攻撃を防止すべきです。

|   #   | Description                                                            | Level | Role |
| :---: | ---------------------------------------------------------------------- | :---: | :--: |
| 2.5.1 | すべての入力エンドポイントに対して、ユーザーごと、IPごと、APIキーごとのレート制限が適用されていることを確認してください。        |   1   | D/V  |
| 2.5.2 | DoS（サービス拒否）攻撃やブルートフォース攻撃を防ぐために、バーストおよび持続的なレート制限が適切に調整されていることを検証してください。 |   2   | D/V  |
| 2.5.3 | 異常な使用パターン（例：短時間に多数のリクエスト、入力の氾濫）が自動的なブロックまたはエスカレーションを引き起こすことを確認してください。  |   2   | D/V  |
| 2.5.4 | 悪用防止ログが保持され、新たな攻撃パターンのためにレビューされていることを確認してください。                         |   3   |  V   |

---

## C2.6 マルチモーダル入力検証

AIシステムは、注入、回避、またはリソースの乱用を防ぐために、非テキスト入力（画像、音声、ファイル）に対して堅牢な検証を含めるべきです。

|   #   | Description                                                          | Level | Role |
| :---: | -------------------------------------------------------------------- | :---: | :--: |
| 2.6.1 | すべての非テキスト入力（画像、音声、ファイル）が処理前にタイプ、サイズ、およびフォーマットについて検証されていることを確認してください。 |   1   |  D   |
| 2.6.2 | ファイルが取り込み前にマルウェアおよびステガノグラフィックペイロードのスキャンを受けていることを確認してください。            |   2   | D/V  |
| 2.6.3 | 画像/音声入力が敵対的摂動や既知の攻撃パターンに対して検査されていることを確認してください。                       |   2   | D/V  |
| 2.6.4 | マルチモーダル入力検証の失敗がログに記録され、調査のためのアラートがトリガーされることを確認してください。                |   3   |  V   |

---

## C2.7 入力の出所と帰属

AIシステムは、すべてのユーザー入力の起源を監視およびタグ付けすることによって、監査、悪用追跡、およびコンプライアンスをサポートすべきです。

|   #   | Description                                                                   | Level | Role |
| :---: | ----------------------------------------------------------------------------- | :---: | :--: |
| 2.7.1 | すべてのユーザー入力が取り込み時にメタデータ（ユーザーID、セッション、ソース、タイムスタンプ、IPアドレス）でタグ付けされていることを確認してください。 |   1   | D/V  |
| 2.7.2 | すべての処理された入力に対して、出所メタデータが保持され、監査可能であることを確認してください。                              |   2   | D/V  |
| 2.7.3 | 異常または信頼できない入力ソースが検出され、強化された監視またはブロックの対象となることを確認してください。                        |   2   | D/V  |

---

## C2.8 リアルタイム適応型脅威検出

開発者は、新しい攻撃パターンに適応し、コンパイルされたパターンマッチングによるリアルタイム保護を提供する高度な脅威検出システムをAIに対して導入すべきです。

|   #   | Description                                                                                | Level | Role |
| :---: | ------------------------------------------------------------------------------------------ | :---: | :--: |
| 2.8.1 | 脅威検出パターンが、レイテンシの影響を最小限に抑えた高性能なリアルタイムフィルタリングのために、最適化された正規表現エンジンにコンパイルされていることを確認してください。      |   1   | D/V  |
| 2.8.2 | 脅威検出システムが異なる脅威カテゴリ（プロンプトインジェクション、有害コンテンツ、機密データ、システムコマンド）ごとに別々のパターンライブラリを維持していることを確認してください。 |   1   | D/V  |
| 2.8.3 | 適応型脅威検出が、攻撃頻度および成功率に基づいて脅威感度を更新する機械学習モデルを組み込んでいることを確認してください。                               |   2   | D/V  |
| 2.8.4 | リアルタイムの脅威インテリジェンスフィードが、新しい攻撃シグネチャやIOC（侵害の指標）を用いてパターンライブラリを自動的に更新することを確認してください。             |   2   | D/V  |
| 2.8.5 | 脅威検出の誤検知率が継続的に監視されており、正当な使用ケースへの干渉を最小限に抑えるためにパターンの特異性が自動的に調整されていることを確認してください。              |   3   | D/V  |
| 2.8.6 | コンテキスト脅威分析が、検出精度を向上させるために、入力ソース、ユーザー行動パターン、およびセッション履歴を考慮していることを確認してください。                   |   3   | D/V  |
| 2.8.7 | 脅威検出のパフォーマンス指標（検出率、処理遅延、リソース利用率）がリアルタイムで監視および最適化されていることを確認する。                              |   3   | D/V  |

---

## C2.9 マルチモーダルセキュリティ検証パイプライン

開発者は、特定の脅威検出とリソース分離を用いて、テキスト、画像、音声、およびその他のAI入力モダリティに対するセキュリティ検証を提供する必要があります。

|   #   | Description                                                                                                            | Level | Role |
| :---: | ---------------------------------------------------------------------------------------------------------------------- | :---: | :--: |
| 2.9.1 | 各入力モダリティに対して、専用のセキュリティバリデータが存在し、文書化された脅威パターン（テキスト：プロンプトインジェクション、画像：ステガノグラフィー、音声：スペクトログラム攻撃）および検出閾値が設定されていることを確認してください。 |   1   | D/V  |
| 2.9.2 | マルチモーダル入力が、それぞれのモダリティタイプに特有のリソース制限（メモリ、CPU、処理時間）を定めた隔離されたサンドボックス環境で処理されていることを確認し、その内容がセキュリティポリシーに文書化されていることを検証してください。  |   2   | D/V  |
| 2.9.3 | クロスモーダル攻撃検出が、複数の入力タイプ（例：画像内のステガノグラフィックペイロードとテキスト内のプロンプトインジェクションの組み合わせ）にまたがる協調攻撃を相関ルールとアラート生成によって特定することを検証してください。       |   2   | D/V  |
| 2.9.4 | マルチモーダル検証の失敗が、すべての入力モダリティ、検証結果、脅威スコア、および相関分析を含む詳細なログ記録をトリガーし、SIEM統合のための構造化ログ形式であることを確認してください。                          |   3   | D/V  |
| 2.9.5 | モダリティ固有のコンテンツ分類器が、記録されたスケジュール（最低でも四半期ごと）に従って、新しい脅威パターン、敵対的事例、およびベースライン閾値を上回る性能ベンチマークで更新されていることを確認してください。               |   3   | D/V  |

---

## 参考文献

* [LLM01:2025 Prompt Injection – OWASP Top 10 for LLM & Generative AI Security](https://genai.owasp.org/llmrisk/llm01-prompt-injection/)
* [Generative AI's Biggest Security Flaw Is Not Easy to Fix](https://www.wired.com/story/generative-ai-prompt-injection-hacking)
* [Many-shot jailbreaking \ Anthropic](https://www.anthropic.com/research/many-shot-jailbreaking)
* [$PDF$ OpenAI GPT-4.5 System Card](https://cdn.openai.com/gpt-4-5-system-card-2272025.pdf)
* [Notebook for the CheckThat Lab at CLEF 2024](https://ceur-ws.org/Vol-3740/paper-53.pdf)
* [Mitigate jailbreaks and prompt injections – Anthropic](https://docs.anthropic.com/en/docs/test-and-evaluate/strengthen-guardrails/mitigate-jailbreaks)
* [Chapter 3 MITRE ATT\&CK – Adversarial Model Analysis](https://ama.drwhy.ai/mitre-attck.html)
* [OWASP Top 10 for LLM Applications 2025 – WorldTech IT](https://wtit.com/blog/2025/04/17/owasp-top-10-for-llm-applications-2025/)
* [OWASP Machine Learning Security Top Ten](https://owasp.org/www-project-machine-learning-security-top-10/)
* [Few words about AI Security – Jussi Metso](https://www.jussimetso.com/index.php/2024/09/28/few-words-about-ai-security/)
* [How To Ensure LLM Output Adheres to a JSON Schema | Modelmetry](https://modelmetry.com/blog/how-to-ensure-llm-output-adheres-to-a-json-schema)
* [Easily enforcing valid JSON schema following – API](https://community.openai.com/t/feature-request-function-calling-easily-enforcing-valid-json-schema-following/263515?utm_source)
* [AI Safety + Cybersecurity R\&D Tracker – Fairly AI](https://www.fairly.ai/blog/ai-cybersecurity-tracker)
* [Anthropic makes 'jailbreak' advance to stop AI models producing harmful results](https://www.ft.com/content/cf11ebd8-aa0b-4ed4-945b-a5d4401d186e)
* [Pattern matching filter rules - IBM](https://www.ibm.com/docs/ssw_aix_71/security/intrusion_pattern_matching_filter_rules.html)
* [Real-time Threat Detection](https://www.darktrace.com/cyber-ai-glossary/real-time-threat-detection)

