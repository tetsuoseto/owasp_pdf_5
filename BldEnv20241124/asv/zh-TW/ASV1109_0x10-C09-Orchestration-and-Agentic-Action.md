# 9 自主編排與代理行動安全

## 控制目標

確保自主或多代理 AI 系統只能執行明確意圖、經過身份驗證、可審計，且在有限成本和風險閾值範圍內的操作。此措施可防範自主系統妥協、工具誤用、代理迴圈檢測、通訊劫持、身份偽冒、群體操控及意圖操縱等威脅。

---

## 9.1 代理任務規劃與遞迴預算

對遞歸計劃進行節流，並對特權操作強制設置人工檢查點。

|   #   | Description                                                         | Level | Role |
| :---: | ------------------------------------------------------------------- | :---: | :--: |
| 9.1.1 | 確保每個代理執行的最大遞迴深度、廣度、實際時間、代幣數量及貨幣成本均由中央配置並進行版本控制。                     |   1   | D/V  |
| 9.1.2 | 確認特權或不可逆的操作（例如，程式碼提交、資金轉移）在執行前需透過可審核的管道獲得明確的人類批准。                   |   1   | D/V  |
| 9.1.3 | 驗證即時資源監控器在超出任何預算閾值時會觸發斷路器中斷，停止進一步的任務擴展。                             |   2   |  D   |
| 9.1.4 | 確認斷路器事件已記錄代理程式 ID、觸發條件以及擷取的計劃狀態以供取證審查。                              |   2   | D/V  |
| 9.1.5 | 驗證安全測試涵蓋預算耗盡和失控計劃情境，確認能安全停止且不會有資料遺失。                                |   3   |  V   |
| 9.1.6 | 驗證預算政策是否以政策即代碼(policy-as-code)方式表達，並在持續整合/持續部署(CI/CD)中強制執行，以阻止配置漂移。 |   3   |  D   |

---

## 9.2 工具插件沙箱化

隔離工具互動以防止未授權的系統存取或程式碼執行。

|   #   | Description                                             | Level | Role |
| :---: | ------------------------------------------------------- | :---: | :--: |
| 9.2.1 | 確認每個工具/插件均在具有最小權限的檔案系統、網路及系統呼叫政策的作業系統、容器或 WASM 級別沙箱內執行。 |   1   | D/V  |
| 9.2.2 | 確認沙箱資源配額（CPU、記憶體、磁碟、網路輸出）及執行逾時是否被強制執行並記錄。               |   1   | D/V  |
| 9.2.3 | 確認工具二進位檔或描述符有數位簽章；在載入前驗證簽章。                             |   2   | D/V  |
| 9.2.4 | 確認沙盒遙測資料流向 SIEM；異常情況（例如嘗試的外向連接）會觸發警報。                   |   2   |  V   |
| 9.2.5 | 確認高風險插件在投入生產部署前經過安全審查和滲透測試。                             |   3   |  V   |
| 9.2.6 | 確認沙盒逃逸嘗試會自動被阻擋，並且涉事插件將被隔離以待調查。                          |   3   | D/V  |

---

## 9.3 自主循環與成本限制

檢測並阻止無控制的代理對代理遞歸及成本激增。

|   #   | Description                              | Level | Role |
| :---: | ---------------------------------------- | :---: | :--: |
| 9.3.1 | 驗證代理間呼叫是否包含跳數限制或 TTL，且運行時系統會對其進行遞減和強制執行。 |   1   | D/V  |
| 9.3.2 | 驗證代理是否維持唯一的調用圖 ID，以識別自我調用或循環模式。          |   2   |  D   |
| 9.3.3 | 驗證累積計算單元和支出計數器是否按請求鏈追蹤；超出限制將中止該鏈。        |   2   | D/V  |
| 9.3.4 | 驗證形式分析或模型檢查能證明代理協議中不存在無界遞迴。              |   3   |  V   |
| 9.3.5 | 驗證迴圈中止事件是否產生警示並提供持續改進的指標。                |   3   |  D   |

---

## 9.4 協議層級誤用防護

在代理和外部系統之間建立安全的通訊通道，以防止劫持或操縱。

|   #   | Description                                        | Level | Role |
| :---: | -------------------------------------------------- | :---: | :--: |
| 9.4.1 | 驗證所有代理到工具及代理到代理的訊息皆經身份驗證（例如，互相 TLS 或 JWT）並進行端對端加密。 |   1   | D/V  |
| 9.4.2 | 驗證結構嚴格被驗證；未知欄位或格式錯誤的訊息將被拒絕。                        |   1   |  D   |
| 9.4.3 | 確認完整性檢查（MAC 或數位簽章）涵蓋整個訊息有效載荷，包括工具參數。               |   2   | D/V  |
| 9.4.4 | 確認在協議層強制執行重放保護（nonce 或時間戳窗口）。                      |   2   |  D   |
| 9.4.5 | 確認協議實作經過模糊測試與靜態分析，以檢測注入或反序列化漏洞。                    |   3   |  V   |

---

## 9.5 代理身份與防篡改證據

確保行動可被追溯且修改可被偵測。

|   #   | Description                      | Level | Role |
| :---: | -------------------------------- | :---: | :--: |
| 9.5.1 | 驗證每個代理實例是否擁有唯一的加密身份（密鑰對或硬體根憑證）。  |   1   | D/V  |
| 9.5.2 | 確認所有代理行為均已簽名並加註時間戳記；日誌包含簽名以防止否認。 |   2   | D/V  |
| 9.5.3 | 確認防竄改日誌是存儲在僅可追加或一次性寫入的媒介中。       |   2   |  V   |
| 9.5.4 | 驗證身份金鑰是否依照既定計劃及在出現妥協跡象時進行輪換。     |   3   |  D   |
| 9.5.5 | 確認仿冒或密鑰衝突嘗試會立即觸發受影響代理的隔離。        |   3   | D/V  |

---

## 9.6 多代理群體風險降低

透過隔離和正式的安全建模來減輕集體行為風險。

|   #   | Description                              | Level | Role |
| :---: | ---------------------------------------- | :---: | :--: |
| 9.6.1 | 驗證在不同安全域中運行的代理是否在隔離的運行時沙箱或網絡區段中執行。       |   1   | D/V  |
| 9.6.2 | 在部署之前，請確認群體行為已被建模並正式驗證其活性和安全性。           |   3   |  V   |
| 9.6.3 | 驗證執行時監控器是否能偵測到新出現的不安全模式（例如振盪、死結）並啟動修正行動。 |   3   |  D   |

---

## 9.7 使用者與工具身份驗證／授權

為每個代理觸發的操作實施強健的存取控制。

|   #   | Description                            | Level | Role |
| :---: | -------------------------------------- | :---: | :--: |
| 9.7.1 | 確認代理人以一級主體身份對下游系統進行身份驗證，且絕不重複使用終端用戶憑證。 |   1   | D/V  |
| 9.7.2 | 驗證細粒度授權政策限制代理人可調用哪些工具以及可提供哪些參數。        |   2   |  D   |
| 9.7.3 | 確認權限檢查在每次呼叫時均重新評估（持續授權），而非僅在會話開始時進行。   |   2   |  V   |
| 9.7.4 | 驗證委派權限是否會自動過期，並在超時或範圍變更後要求重新同意。        |   3   |  D   |

---

## 9.8 代理對代理通信安全

加密並完整性保護所有代理人之間的訊息，以防止竊聽和篡改。

|   #   | Description                           | Level | Role |
| :---: | ------------------------------------- | :---: | :--: |
| 9.8.1 | 確認代理通道必須使用相互驗證和完美前向保密加密（例如 TLS 1.3）。  |   1   | D/V  |
| 9.8.2 | 在處理之前，請驗證訊息的完整性與來源；若驗證失敗，則發出警報並丟棄該訊息。 |   1   |  D   |
| 9.8.3 | 驗證是否記錄通訊的元資料（時間戳、序列號）以支持取證重建。         |   2   | D/V  |
| 9.8.4 | 驗證形式驗證或模型檢查確認協議狀態機無法進入不安全狀態。          |   3   |  V   |

---

## 9.9 意圖驗證與約束強制

驗證代理行動是否符合使用者所述的意圖及系統限制。

|   #   | Description                                     | Level | Role |
| :---: | ----------------------------------------------- | :---: | :--: |
| 9.9.1 | 驗證前置執行約束求解器是否根據硬編碼的安全和政策規則來檢查建議的行動。             |   1   |  D   |
| 9.9.2 | 確認高影響行動（財務、破壞性、隱私敏感）需要啟動用戶明確的意圖確認。              |   2   | D/V  |
| 9.9.3 | 驗證後置條件檢查以確保已完成的操作達到預期效果且無副作用；若有不符，則觸發回滾。        |   2   |  V   |
| 9.9.4 | 驗證形式方法（例如模型檢查、定理證明）或基於屬性的測試，以證明代理計劃滿足所有聲明的約束條件。 |   3   |  V   |
| 9.9.5 | 確保意圖不匹配或約束違規事件能促進持續改進循環和威脅情報共享。                 |   3   |  D   |

---

## 9.10 代理推理策略安全性

安全選擇和執行不同推理策略，包括 ReAct、連鎖思考（Chain-of-Thought）和思維樹（Tree-of-Thoughts）方法。

|   #    | Description                                                                      | Level | Role |
| :----: | -------------------------------------------------------------------------------- | :---: | :--: |
| 9.10.1 | 驗證推理策略選擇是否使用確定性標準（輸入複雜度、任務類型、安全性上下文），並確保在相同安全性上下文中，相同輸入產生相同的策略選擇。                |   1   | D/V  |
| 9.10.2 | 確認每種推理策略（ReAct、Chain-of-Thought、Tree-of-Thoughts）皆具備針對其認知方法所專屬的輸入驗證、輸出淨化及執行時間限制。 |   1   | D/V  |
| 9.10.3 | 確認推理策略轉換已記錄完整上下文，包括輸入特徵、選擇標準值和執行元資料，以便重建審計追蹤。                                    |   2   | D/V  |
| 9.10.4 | 確認樹狀思考推理包含分支修剪機制，當檢測到政策違規、資源限制或安全邊界時終止探索。                                        |   2   | D/V  |
| 9.10.5 | 驗證 ReAct（推理-行動-觀察）循環是否在每個階段包含驗證檢查點：推理步驟驗證、行動授權以及繼續之前的觀察淨化。                       |   2   | D/V  |
| 9.10.6 | 確認推理策略的效能指標（執行時間、資源使用量、輸出品質）在超出設定閾值時，能透過自動警示進行監控。                                |   3   | D/V  |
| 9.10.7 | 驗證結合多重策略的混合推理方法能維持所有構成策略的輸入驗證和輸出限制，且不會繞過任何安全控制。                                  |   3   | D/V  |
| 9.10.8 | 驗證推理策略安全測試包括使用格式錯誤的輸入進行模糊測試、設計用於強制策略切換的對抗性提示，以及對每種認知方法進行邊界條件測試。                  |   3   | D/V  |

---

## 9.11 代理生命週期狀態管理與安全性

使用加密審計軌跡和明確的恢復程序，確保代理初始化、狀態轉換和終止的安全性。

|   #    | Description                                                                   | Level | Role |
| :----: | ----------------------------------------------------------------------------- | :---: | :--: |
| 9.11.1 | 驗證代理初始化是否包含使用硬體支持的憑證建立密碼學身份，並且不可變動的啟動審計日誌中包含代理ID、時間戳記、配置雜湊值及初始化參數。            |   1   | D/V  |
| 9.11.2 | 驗證代理狀態轉換是否經過密碼學簽名、時間戳記，並完整記錄上下文，包括觸發事件、前一狀態雜湊、新狀態雜湊及執行的安全驗證。                  |   2   | D/V  |
| 9.11.3 | 確認代理程式關閉程序包含使用密碼學抹除或多次覆寫進行安全記憶體清除、憑證撤銷並通知憑證授權機構，以及產生防篡改的終止證明書。                |   2   | D/V  |
| 9.11.4 | 驗證代理恢復機制使用密碼學校驗和（至少為 SHA-256）來驗證狀態完整性，並在檢測到損壞時回滾到已知良好狀態，同時具備自動警報和手動批准要求。      |   3   | D/V  |
| 9.11.5 | 驗證代理持久性機制是否使用每個代理的 AES-256 金鑰加密敏感狀態資料，並在可配置的排程（最長 90 天）上實施安全的金鑰輪替，且部署過程無停機時間。 |   3   | D/V  |

---

## 9.12 工具整合安全框架

針對動態工具加載、執行及結果驗證，實施具有明確風險評估與批准流程的安全控管措施。

|   #    | Description                                                                       | Level | Role |
| :----: | --------------------------------------------------------------------------------- | :---: | :--: |
| 9.12.1 | 確認工具描述符包含安全元數據，指定所需的權限（讀取/寫入/執行）、風險等級（低/中/高）、資源限制（CPU、記憶體、網路）及工具清單中記錄的驗證要求。       |   1   | D/V  |
| 9.12.2 | 確認工具執行結果在整合前，已根據預期的架構（JSON Schema、XML Schema）及安全政策（輸出消毒、資料分類）進行驗證，並具備逾時限制及錯誤處理程序。 |   1   | D/V  |
| 9.12.3 | 確認工具互動日誌包含詳細的安全上下文，包括權限使用情況、數據訪問模式、執行時間、資源消耗和返回代碼，並使用結構化日誌以便整合至 SIEM。             |   2   | D/V  |
| 9.12.4 | 驗證動態工具加載機制是否使用公鑰基礎設施 (PKI) 進行數位簽章驗證，並且在執行前實施具有沙盒隔離和權限驗證的安全加載協定。                   |   2   | D/V  |
| 9.12.5 | 驗證工具安全評估是否會自動針對新版本觸發，並包含具強制性核准閘門，如靜態分析、動態測試及安全團隊審查，且具備有文件化的核准標準及服務水準協議（SLA）要求。    |   3   | D/V  |

---

### 參考文獻

* [MITRE ATLAS tactics ML09](https://atlas.mitre.org/)
* [Circuit-breaker research for AI agents — Zou et al., 2024](https://arxiv.org/abs/2406.04313)
* [Trend Micro analysis of sandbox escapes in AI agents — Park, 2025](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/unveiling-ai-agent-vulnerabilities-code-execution)
* [Auth0 guidance on human-in-the-loop authorization for agents — Martinez, 2025](https://auth0.com/blog/secure-human-in-the-loop-interactions-for-ai-agents/)
* [Medium deep-dive on MCP & A2A protocol hijacking — ForAISec, 2025](https://medium.com/%40foraisec/security-analysis-potential-ai-agent-hijacking-via-mcp-and-a2a-protocol-insights-cd1ec5e6045f)
* [Rapid7 fundamentals on spoofing attack prevention — 2024](https://www.rapid7.com/fundamentals/spoofing-attacks/)
* [Imperial College verification of swarm systems — Lomuscio et al.](https://sail.doc.ic.ac.uk/projects/swarms/)
* [NIST AI Risk Management Framework 1.0, 2023](https://nvlpubs.nist.gov/nistpubs/ai/nist.ai.100-1.pdf)
* [WIRED security briefing on encryption best practices, 2024](https://www.wired.com/story/encryption-apps-chinese-telecom-hacking-hydra-russia-exxon)
* [OWASP Top 10 for LLM Applications, 2025](https://owasp.org/www-project-top-10-for-large-language-model-applications/)
* [Comprehensive Vulnerability Analysis is Necessary for Trustworthy LLM-MAS](https://arxiv.org/html/2506.01245v1)
* [How Is LLM Reasoning Distracted by Irrelevant Context?
  An Analysis Using a Controlled Benchmark](https://www.arxiv.org/pdf/2505.18761)
* [Large Language Model Sentinel: LLM Agent for Adversarial Purification](https://arxiv.org/pdf/2405.20770)
* [Securing Agentic AI: A Comprehensive Threat Model and Mitigation Framework for Generative AI Agents](https://arxiv.org/html/2504.19956v2)

