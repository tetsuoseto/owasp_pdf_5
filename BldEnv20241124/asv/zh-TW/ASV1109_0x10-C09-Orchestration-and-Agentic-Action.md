# 9 自主編排與能動行動安全

## 控制目標

確保自主或多代理人工智慧系統僅能執行明確意圖、經過驗證、可審計且在成本與風險邊界內的行動。此措施可防範自主系統遭入侵、工具誤用、代理迴圈偵測、通訊劫持、身份偽造、群體操控及意圖操縱等威脅。

---

## 9.1 代理任務規劃與遞迴預算

限制遞迴計畫的頻率並強制對特權操作設置人工檢查點。

|   #   | Description                                        | Level | Role |
| :---: | -------------------------------------------------- | :---: | :--: |
| 9.1.1 | 驗證每個代理執行的最大遞歸深度、寬度、實際運行時間、標記數和貨幣成本是否由中央配置且受版本控制。   |   1   | D/V  |
| 9.1.2 | 確認特權或不可逆的操作（例如代碼提交、資金轉移）在執行前需透過可審核的渠道獲得明確的人為批准。    |   1   | D/V  |
| 9.1.3 | 確認即時資源監控器在超過任何預算閾值時觸發斷路器中斷，停止進一步的任務擴展。             |   2   |  D   |
| 9.1.4 | 確認電路斷路器事件已記錄代理ID、觸發條件及擷取的計劃狀態，以供取證審查。              |   2   | D/V  |
| 9.1.5 | 確認安全測試涵蓋預算耗盡和失控計劃場景，確保能安全停止且不會資料遺失。                |   3   |  V   |
| 9.1.6 | 驗證預算政策是否以政策即代碼的形式表達，並在持續整合/持續交付（CI/CD）中執行，以阻止配置漂移。 |   3   |  D   |

---

## 9.2 工具插件沙箱技術

將工具交互隔離，以防止未授權的系統訪問或程式碼執行。

|   #   | Description                                                | Level | Role |
| :---: | ---------------------------------------------------------- | :---: | :--: |
| 9.2.1 | 確保每個工具/插件都在操作系統、容器或 WASM 級別的沙箱內執行，並且採用最小權限的檔案系統、網路和系統呼叫策略。 |   1   | D/V  |
| 9.2.2 | 驗證沙盒資源配額（CPU、記憶體、磁碟、網路外發流量）及執行逾時是否被強制執行並記錄。                |   1   | D/V  |
| 9.2.3 | 驗證工具的二進位檔或描述符是否具備數位簽章；在載入前須先驗證簽章。                          |   2   | D/V  |
| 9.2.4 | 驗證沙箱遙測資料是否流向SIEM；異常狀況（例如，嘗試進行外部連線）會觸發警報。                   |   2   |  V   |
| 9.2.5 | 確保高風險插件在投入生產部署前經過安全審查和滲透測試。                                |   3   |  V   |
| 9.2.6 | 確認沙盒逃逸嘗試會被自動阻止，且有問題的插件會被隔離以待調查。                            |   3   | D/V  |

---

## 9.3 自主循環與成本界限

偵測並阻止無控制的代理對代理遞迴及成本暴增。

|   #   | Description                             | Level | Role |
| :---: | --------------------------------------- | :---: | :--: |
| 9.3.1 | 確認代理間呼叫包含一個由執行環境遞減並強制執行的跳數限制或存活時間（TTL）。 |   1   | D/V  |
| 9.3.2 | 驗證代理保持唯一的調用圖 ID 以識別自我調用或循環模式。           |   2   |  D   |
| 9.3.3 | 驗證累積計算單位和花費計數器是否按請求鏈進行追蹤；超出限制將中止該鏈。     |   2   | D/V  |
| 9.3.4 | 驗證形式分析或模型檢查是否證明代理協議中不存在無界遞歸。            |   3   |  V   |
| 9.3.5 | 驗證迴圈中止事件是否會生成警報並提供持續改進的指標。              |   3   |  D   |

---

## 9.4 協議層級誤用防護

在代理與外部系統之間建立安全通訊通道，以防止劫持或操控。

|   #   | Description                                        | Level | Role |
| :---: | -------------------------------------------------- | :---: | :--: |
| 9.4.1 | 確認所有代理對工具以及代理對代理的訊息皆經過驗證（例如雙向 TLS 或 JWT），並進行端對端加密。 |   1   | D/V  |
| 9.4.2 | 驗證架構是否被嚴格驗證；未知欄位或格式錯誤的訊息將被拒絕。                      |   1   |  D   |
| 9.4.3 | 確認完整性檢查（MAC 或數位簽章）涵蓋整個訊息負載，包括工具參數。                 |   2   | D/V  |
| 9.4.4 | 驗證在協議層強制執行重播保護（使用隨機數或時間戳窗口）。                       |   2   |  D   |
| 9.4.5 | 驗證協定實作是否經過模糊測試（fuzzing）和靜態分析，以檢查注入或反序列化漏洞。         |   3   |  V   |

---

## 9.5 代理身份與防篡改証明

確保行為可追溯且修改可被檢測。

|   #   | Description                      | Level | Role |
| :---: | -------------------------------- | :---: | :--: |
| 9.5.1 | 驗證每個代理實例是否擁有唯一的加密身份（密鑰對或硬體根憑證）。  |   1   | D/V  |
| 9.5.2 | 確認所有代理動作皆已簽署及標註時間戳；日誌中包含簽名以防否認。  |   2   | D/V  |
| 9.5.3 | 確認防篡改日誌存儲在僅追加或一次性寫入的媒介中。         |   2   |  V   |
| 9.5.4 | 驗證身份金鑰是否依照既定的時間表以及在偵測到妥協指標時進行輪替。 |   3   |  D   |
| 9.5.5 | 確認欺騙或金鑰衝突嘗試會立即觸發對受影響代理的隔離。       |   3   | D/V  |

---

## 9.6 多智能體蜂群風險降低

透過隔離和正式安全建模來減輕集體行為風險。

|   #   | Description                               | Level | Role |
| :---: | ----------------------------------------- | :---: | :--: |
| 9.6.1 | 驗證在不同安全領域內運作的代理程式是否於隔離的執行環境沙盒或網路區段中執行。    |   1   | D/V  |
| 9.6.2 | 在部署之前，驗證群體行為的建模並正式驗證其活性和安全性。              |   3   |  V   |
| 9.6.3 | 驗證運行時監控器是否能夠偵測到新興的不安全模式（例如，振盪、死鎖）並啟動糾正措施。 |   3   |  D   |

---

## 9.7 使用者與工具認證／授權

為每個代理觸發的操作實施強健的存取控制。

|   #   | Description                               | Level | Role |
| :---: | ----------------------------------------- | :---: | :--: |
| 9.7.1 | 驗證代理程式是否以一級主體身份向下游系統進行身份驗證，且絕不重複使用終端用戶憑證。 |   1   | D/V  |
| 9.7.2 | 確認細粒度授權策略限制代理程式可呼叫的工具以及可提供的參數。            |   2   |  D   |
| 9.7.3 | 驗證權限檢查是否在每次呼叫時重新評估（持續授權），而不僅僅是在會話開始時進行。   |   2   |  V   |
| 9.7.4 | 驗證委派權限會自動過期，並在超時或範圍變更後需要重新同意。             |   3   |  D   |

---

## 9.8 代理與代理之間的通訊安全

對所有代理間的訊息進行加密及完整性保護，以防止竊聽和篡改。

|   #   | Description                          | Level | Role |
| :---: | ------------------------------------ | :---: | :--: |
| 9.8.1 | 確認代理通道必須採用雙向驗證和完美前向保密加密（例如 TLS 1.3）。 |   1   | D/V  |
| 9.8.2 | 在處理之前，驗證訊息的完整性和來源；失敗時將觸發警報並丟棄訊息。     |   1   |  D   |
| 9.8.3 | 確認通訊元資料（時間戳記、序列號碼）已被記錄，以支持取證重建。      |   2   | D/V  |
| 9.8.4 | 確認形式驗證或模型檢查證實協議狀態機無法被驅動進入不安全狀態。      |   3   |  V   |

---

## 9.9 意圖驗證與約束執行

驗證代理行動是否符合用戶陳述的意圖和系統限制。

|   #   | Description                                   | Level | Role |
| :---: | --------------------------------------------- | :---: | :--: |
| 9.9.1 | 驗證前執行約束求解器是否根據硬編碼的安全性和政策規則檢查擬議的行動。            |   1   |  D   |
| 9.9.2 | 確認高影響行為（財務、破壞性、隱私敏感）需要來自主動用戶的明確意圖確認。          |   2   | D/V  |
| 9.9.3 | 驗證後置條件檢查，確保已完成的動作達成預期效果且無副作用；若有差異則觸發回滾。       |   2   |  V   |
| 9.9.4 | 驗證形式方法（例如，模型檢查、定理證明）或基於屬性的測試能證明代理計劃滿足所有聲明的約束。 |   3   |  V   |
| 9.9.5 | 確認意圖不匹配或約束違規事件會促進持續改進循環和威脅情報共享。               |   3   |  D   |

---

## 9.10 代理推理策略安全性

安全選擇和執行不同的推理策略，包括 ReAct、Chain-of-Thought 及 Tree-of-Thoughts 方法。

|   #    | Description                                                                        | Level | Role |
| :----: | ---------------------------------------------------------------------------------- | :---: | :--: |
| 9.10.1 | 驗證推理策略選擇使用確定性標準（輸入複雜度、任務類型、安全性上下文），並且在相同安全性上下文中，輸入相同的資料會產生相同的策略選擇。                 |   1   | D/V  |
| 9.10.2 | 驗證每種推理策略（ReAct、Chain-of-Thought、Tree-of-Thoughts）是否具有專門的輸入驗證、輸出消毒和執行時間限制，以符合其認知方法。 |   1   | D/V  |
| 9.10.3 | 驗證推理策略轉換是否已完整記錄上下文，包括輸入特徵、選擇標準值和執行元資料，以便審計追蹤重建。                                    |   2   | D/V  |
| 9.10.4 | 請確認「思維樹」（Tree-of-Thoughts）推理包含分支剪枝機制，當偵測到政策違規、資源限制或安全邊界時會終止探索。                     |   2   | D/V  |
| 9.10.5 | 驗證 ReAct（推理-行動-觀察）循環在每個階段均包含驗證檢查點：推理步驟驗證、行動授權，以及在繼續之前的觀察清理。                        |   2   | D/V  |
| 9.10.6 | 確認推理策略的效能指標（執行時間、資源使用率、輸出品質）在指標偏離設定閾值時有自動警示監控。                                     |   3   | D/V  |
| 9.10.7 | 驗證結合多種策略的混合推理方法是否保持所有組成策略的輸入驗證和輸出約束，且未繞過任何安全控制。                                    |   3   | D/V  |
| 9.10.8 | 驗證推理策略安全測試包括使用格式錯誤的輸入進行模糊測試、設計用於強制策略切換的對抗性提示，以及對每種認知方法進行邊界條件測試。                    |   3   | D/V  |

---

## 9.11 代理生命週期狀態管理與安全性

使用加密審計軌跡和明確的恢復程序，確保代理初始化、狀態轉換和終止的安全。

|   #    | Description                                                                | Level | Role |
| :----: | -------------------------------------------------------------------------- | :---: | :--: |
| 9.11.1 | 驗證代理初始化包括使用硬體支持的憑證建立加密身份，以及包含代理ID、時間戳、配置哈希和初始化參數的不可變啟動審計日誌。                |   1   | D/V  |
| 9.11.2 | 驗證代理狀態轉換是否經過密碼學簽名、時間戳記，並完整記錄上下文，包括觸發事件、先前狀態哈希、新狀態哈希及執行的安全驗證。               |   2   | D/V  |
| 9.11.3 | 驗證代理關閉程序是否包含使用密碼學擦除或多重覆寫來進行安全記憶體清除、憑證撤銷並通知證書管理機構，以及生成具防篡改特性的終止證書。          |   2   | D/V  |
| 9.11.4 | 驗證代理恢復機制是否使用密碼學校驗和（至少為SHA-256）來驗證狀態完整性，並在檢測到損壞時回滾至已知良好狀態，同時配備自動警報和人工批准要求。  |   3   | D/V  |
| 9.11.5 | 驗證代理持久化機制使用每個代理專用的 AES-256 金鑰加密敏感狀態資料，並在可配置的時間表（最多90天）上實施安全的金鑰輪換，且確保零停機部署。 |   3   | D/V  |

---

## 9.12 工具整合安全架構

動態工具載入、執行及結果驗證的安全控制，並具備明確的風險評估與審批流程。

|   #    | Description                                                                          | Level | Role |
| :----: | ------------------------------------------------------------------------------------ | :---: | :--: |
| 9.12.1 | 驗證工具描述符是否包含指定所需權限（讀取/寫入/執行）、風險等級（低/中/高）、資源限制（CPU、記憶體、網路）以及驗證需求的安全元資料，並且這些資訊記錄於工具清單中。 |   1   | D/V  |
| 9.12.2 | 確保工具執行結果在整合前經過預期結構（JSON Schema、XML Schema）及安全政策（輸出清理、資料分類）的驗證，並具備逾時限制與錯誤處理程序。        |   1   | D/V  |
| 9.12.3 | 驗證工具互動日誌包含詳細的安全上下文，包括權限使用情況、數據訪問模式、執行時間、資源消耗以及帶有結構化日誌以便集成安全事件管理系統（SIEM）的返回代碼。        |   2   | D/V  |
| 9.12.4 | 確認動態工具加載機制使用公鑰基礎設施（PKI）驗證數位簽章，並且在執行前實施具有沙盒隔離和權限驗證的安全加載協議。                            |   2   | D/V  |
| 9.12.5 | 驗證工具安全性評估是否會自動針對新版本觸發，並包含強制性批准門檻，包括靜態分析、動態測試及安全團隊審查，且具有文件化的批准標準和服務等級協議（SLA）要求。       |   3   | D/V  |

---

### 參考文獻

* [MITRE ATLAS tactics ML09](https://atlas.mitre.org/)
* [Circuit-breaker research for AI agents — Zou et al., 2024](https://arxiv.org/abs/2406.04313)
* [Trend Micro analysis of sandbox escapes in AI agents — Park, 2025](https://www.trendmicro.com/vinfo/us/security/news/cybercrime-and-digital-threats/unveiling-ai-agent-vulnerabilities-code-execution)
* [Auth0 guidance on human-in-the-loop authorization for agents — Martinez, 2025](https://auth0.com/blog/secure-human-in-the-loop-interactions-for-ai-agents/)
* [Medium deep-dive on MCP & A2A protocol hijacking — ForAISec, 2025](https://medium.com/%40foraisec/security-analysis-potential-ai-agent-hijacking-via-mcp-and-a2a-protocol-insights-cd1ec5e6045f)
* [Rapid7 fundamentals on spoofing attack prevention — 2024](https://www.rapid7.com/fundamentals/spoofing-attacks/)
* [Imperial College verification of swarm systems — Lomuscio et al.](https://sail.doc.ic.ac.uk/projects/swarms/)
* [NIST AI Risk Management Framework 1.0, 2023](https://nvlpubs.nist.gov/nistpubs/ai/nist.ai.100-1.pdf)
* [WIRED security briefing on encryption best practices, 2024](https://www.wired.com/story/encryption-apps-chinese-telecom-hacking-hydra-russia-exxon)
* [OWASP Top 10 for LLM Applications, 2025](https://owasp.org/www-project-top-10-for-large-language-model-applications/)
* [Comprehensive Vulnerability Analysis is Necessary for Trustworthy LLM-MAS](https://arxiv.org/html/2506.01245v1)
* [How Is LLM Reasoning Distracted by Irrelevant Context?
  An Analysis Using a Controlled Benchmark](https://www.arxiv.org/pdf/2505.18761)
* [Large Language Model Sentinel: LLM Agent for Adversarial Purification](https://arxiv.org/pdf/2405.20770)
* [Securing Agentic AI: A Comprehensive Threat Model and Mitigation Framework for Generative AI Agents](https://arxiv.org/html/2504.19956v2)

